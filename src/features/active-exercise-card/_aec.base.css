/* CEMENTED: spacing system
 - No !important, no structure edits, no sub-1 line-height (except tokenized timer line-height in active).
 - Prefer parent-scoped tokens for sibling spacing.
 - Keep stack rhythm (16px) as the primary separator; remove inner gaps. */
/*
  ACTIVE EXERCISE CARD — rhythm (16/7/7), selector=100px, adherence color

  Rules of engagement:
  - Spacing uses tokens + cap-aware margins only (no transforms / no !important).
  - Headers readable (no sub-1 line-height anywhere).
  - Selector outer shell locked to exactly 100px; inner text is temporarily auto-balanced.
*/

/* ===== Card inset (border-aware 16px) ===== */
#active-card-container .card-content-container {
  padding: calc(var(--space-m) - var(--card-border-width, 2px));
}

/* ===== Header block (two rows) ===== */
#active-card-container .card-header-container {
  display: flex;
  flex-direction: column;
  row-gap: 0; /* control spacing via margins on the lines below */
  margin: 0;
}

/* One header row: left label + right clock */
#active-card-container .card-header-line {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-m);
  min-width: 0;
  margin: 0;
}

/* Reset any stray default margins on nested headings/paragraphs */
#active-card-container .card-header-line h1,
#active-card-container .card-header-line h2,
#active-card-container .card-header-line h3,
#active-card-container .card-header-line h4,
#active-card-container .card-header-line h5,
#active-card-container .card-header-line h6,
#active-card-container .card-header-line p {
  margin: 0;
}

/* Header typography — readable (no clipping) */
#active-card-container .card-header-dynamic-text,
#active-card-container .card-header-clock {
  color: var(--on-surface-light);
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: var(--lh-normal);
  display: flex;
  align-items: baseline;
  gap: var(--space-m);
  min-width: 0;
}

/* Keep inner spans at normal line-height */
#active-card-container .card-header-dynamic-text > span,
#active-card-container .card-header-clock > span {
  line-height: var(--lh-normal);
}

/* Subtle right-edge alignment quirk preserved */
#active-card-container .card-header-line > *:last-child {
  margin-right: -1px;
}

/* ===== Selector under header =====
   TEMP: Vertical balance via flex centering; replace with tokenized padding later. */
#exercise-selector { margin: 0; }

#active-card-container .app-selector > summary {
  box-sizing: border-box;
  height: 100px;                 /* CEMENTED: requested exact height */
  min-height: 100px;             /* safety against external overrides */
  display: flex;                 /* TEMP auto-balance */
  align-items: center;           /* vertical centering for now */
  padding-top: 0;                /* prevent height creep */
  padding-bottom: 0;             /* prevent height creep */
  padding-left: var(--space-m);  /* keep 16px column */
  padding-right: var(--space-m); /* keep 16px column */
}

/* Selector typography (kept tasteful; will be tokenized later) */
#exercise-selector.app-selector { font-size: initial; font-weight: initial; }
#exercise-selector .selector-content { font-weight: 500; }
#exercise-selector .item-main-line {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 2px; /* TEMP for the 100px shell */
}
#exercise-selector .flex-separator { font-weight: 600; margin: 0 var(--space-xxs, 4px); }
#exercise-selector .options-list li .item-main-line { margin-bottom: 0; line-height: 1.1; }

/* ===== Other preserved layout ===== */
.youtube-overlay-wrapper { position: relative; }
.input-group { margin: 0; }
#card-anchor-area { position: relative; z-index: 1; }
#card-action-area { margin: 0; }

/* Action prompt + labels (unchanged) */
.action-prompt-text,
.resting-label {
  font-size: var(--font-size-h2);
  font-weight: 600;
  color: var(--primary-blue-dark);
  cursor: pointer;
  min-width: 0;
  text-align: center;
}
.resting-label { color: var(--on-surface-medium); }

.action-prompt-text > .truncate-text,
.resting-label > .truncate-text { line-height: var(--lh-normal); }

body.start-glow-animations .action-prompt-text.is-glowing span {
  animation: text-glow 4s ease-in-out infinite;
}

/* Buttons & dual areas */
.action-button-group { display: flex; flex-direction: column; gap: var(--space-m); }
.timer-container { display: flex; flex-direction: column; }
.timer-container .timer-display {
  font-size: 5.5rem;
  font-weight: 700;
  line-height: var(--lh-normal);
  display: flex; align-items: center; justify-content: center;
}
.dual-fuel-gauge-container { display: flex; gap: var(--space-m); height: var(--control-height); }
.dual-action-area-container { display: flex; gap: var(--space-m); flex-grow: 1; }

/* Waiting state */
.waiting-card-message {
  color: var(--on-surface-medium);
  text-align: center;
  font-style: italic;
  padding-block: var(--space-xl, 40px) 0;
}

/* Muting logic (preserved) */
.is-muted { pointer-events: none; }
.is-muted > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}
.is-muted > summary .selector-content { opacity: 0.2; }
summary.is-content-muted .selector-content { opacity: 0.2; }

/* Global override while ANY selector is open */
body.is-selector-open details:not([open]) { pointer-events: none; }
body.is-selector-open
  details:not(.workout-log-item-container):not([open])
  > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}
body.is-selector-open
  details:not(.workout-log-item-container):not([open])
  > summary .selector-content {
  filter: brightness(0.5) saturate(0.5);
  opacity: 0.7;
}

/* Utilities */
.text-primary { color: var(--primary-blue); }
.text-info    { color: var(--on-surface-medium); }

/* ---------------------------------------------------------------------------------
   Targets:
     • Top → “Current Exercise” line = 16px (visual)
     • “Current Exercise” → “# Minutes Remaining” = 7px (visual)
     • “# Minutes Remaining” → selector = 7px (visual)

   These micro-tweaks were measured to fix 17/9/15 → 16/7/7 exactly.
----------------------------------------------------------------------------------*/

/* Scoped micro-tokens — safe to tune if the font metrics change */
#active-card-container {
  --cap-tweak-top: 1px;        /* pulls first line up +1px → 16px top */
  --cap-tweak-internal: 2px;   /* reduces line↔line by 2px → 7px */
  --cap-tweak-bottom: 8px;     /* reduces second→selector by 8px → 7px */
}

/* Ensure we’re hitting the wrapper that renders header lines */
#active-card-container #active-card-header {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 0;
}

/* Top edge → first line = 16px */
#active-card-container #active-card-header > .card-header-line:first-child {
  margin-top: calc((var(--cap-offset-h2, 5px) + var(--cap-tweak-top)) * -1);
}

/* First line → second line = 7px (7 - 2*cap - tweak) */
#active-card-container #active-card-header > .card-header-line:nth-child(2) {
  margin-top: calc(var(--space-s) - (var(--cap-offset-h2, 5px) * 2) - var(--cap-tweak-internal));
}

/* Second line → selector = 7px (7 - cap - tweak) */
#active-card-container #active-card-header > .card-header-line:last-child {
  margin-bottom: calc(var(--space-s) - var(--cap-offset-h2, 5px) - var(--cap-tweak-bottom));
}

/* CEMENTED — Adherence color lock (resilient to re-renders) */
#active-card-container .card-header-line.text-plan .card-header-dynamic-text,
#active-card-container .card-header-line.text-plan .card-header-clock,
#active-card-container .card-header-line .card-header-dynamic-text.text-plan,
#active-card-container .card-header-line .card-header-clock.text-plan {
  color: var(--adherence-green);
}
#active-card-container .card-header-line.text-deviation .card-header-dynamic-text,
#active-card-container .card-header-line.text-deviation .card-header-clock,
#active-card-container .card-header-line .card-header-dynamic-text.text-deviation,
#active-card-container .card-header-line .card-header-clock.text-deviation {
  color: var(--adherence-olive);
}
#active-card-container .card-header-line.text-warning .card-header-dynamic-text,
#active-card-container .card-header-line.text-warning .card-header-clock,
#active-card-container .card-header-line .card-header-dynamic-text.text-warning,
#active-card-container .card-header-line .card-header-clock.text-warning {
  color: var(--adherence-yellow);
}


/* Fuel Gauge anchor spacing: enforce 16/16 via tokens */
#active-card-container #card-anchor-area {
  margin-top: var(--anchor-gap-top, 9px);
  margin-bottom: var(--anchor-gap-bottom, 4px);
}


#active-card-container #card-action-area .action-prompt-text {
  margin-top: var(--cap-fix-action-prompt-top, -3px);
  margin-bottom: var(--cap-fix-action-prompt-bottom, 0px);
  padding: 0;
  line-height: var(--lh-normal);
  display: flex;
  align-items: center;
  justify-content: center;
}

#active-card-container #card-action-area .resting-label {
  margin-top: var(--cap-fix-resting-label-top, -3px);
  margin-bottom: var(--cap-fix-resting-label-bottom, 0px);
  padding: 0;
  line-height: var(--lh-normal);
  display: flex;
  align-items: center;
  justify-content: center;
}

#active-card-container #card-action-area .timer-display {
  margin: 0;
  line-height: var(--lh-normal);
  margin-top: var(--cap-fix-timer-top, 0px);
  margin-bottom: var(--cap-fix-timer-bottom, 0px);
}

#active-card-container #card-action-area .action-button-group {
  margin: 0;
}



/* CEMENTED (inactive only): tokens define spacing, no structure changes */
#active-card-container #card-anchor-area {
  margin-top: var(--anchor-gap-top);
  margin-bottom: var(--anchor-gap-bottom);
}
#active-card-container #card-action-area 
/* CEMENTED: Inactive prompt spacing — redistribute 7px to match active height */


.action-prompt-block.is-prompt .action-prompt-text {
  margin-top: var(--cap-fix-action-prompt-top);
  margin-bottom: var(--cap-fix-action-prompt-bottom);
}
#active-card-container #card-action-area .action-button-group { margin: 0; padding-top: 0; padding-bottom: 0; }






/* Inactive state: buttons keep 16px tokenized spacing */
#active-card-container #card-action-area .action-button-group {
  gap: var(--space-m);
}


/* Active (resting) only: collapse internal gaps so outer .stack sets 16px rhythm */
#active-card-container #card-action-area.stack .action-prompt-blockimer container */
#active-card-container #card-action-area.stack .action-prompt-block


/* Active (resting) only: visually trim leading with transform-based shifts */
#active-card-container #card-action-area.stack .action-prompt-blockk





/* Active (resting) only: adjust container flow to achieve 16/16/16 */
#active-card-container #card-action-area.stack .action-prompt-block
#active-card-container #card-action-area.stack .action-prompt-block

#active-card-container #card-action-area.stack > .action-prompt-block

/* Prompt block and its internals don't add extra vertical space */
#active-card-container #card-action-area.stack > .action-prompt-block > .timer-container { margin: 0; padding: 0; }
#active-card-container #card-action-area.stack > .timer-container .timer-display { margin: 0; line-height: var(--lh-normal); }
#active-card-container #card-action-area.stack > .action-button-group { margin: 0; padding-top: 0; padding-bottom: 0; }

#active-card-container #card-action-area.stack > .action-prompt-block


/* Active workout only: collapse inner gaps so stack controls rhythm */
#active-card-container #card-action-area.stack > .timer-container,



/* Active (resting) only: fine-tune timer vertical alignment */
#active-card-container #card-action-area.stack .action-prompt-block

/* FINAL: Active (resting) — force timer line-height using adjacent sibling to trim leading */
/* CEMENTED: Final override — timer line-height & centering wins cascade in active */
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting + .timer-container .timer-display {
  text-align: center;
  display: block;
  line-height: var(--cap-active-timer-line-height);
  margin-top: var(--cap-active-timer-top-adjust);
  margin-bottom: var(--cap-active-timer-bottom-adjust);
}



/* Active (resting) — define spacing tokens on the parent so they cascade to siblings */
/* CEMENTED: Active tokens host (parent)
   Siblings inherit custom properties from the parent */




/* Inactive (prompt) — tokens live on the parent so they reach siblings */

/* Inactive (prompt) — tokens on parent for sibling/descendant spacing */


/* FINAL: Inactive (prompt) — redistribute 7px inside the text group */
/* CEMENTED: Inactive prompt spacing — redistribute 7px to match active height */
