/*
  ACTIVE EXERCISE CARD — rhythm (16/7/7), selector=100px, adherence color

  Rules of engagement:
  - Spacing uses tokens + cap-aware margins only (no transforms / no !important).
  - Headers readable (no sub-1 line-height anywhere).
  - Selector outer shell locked to exactly 100px; inner text is temporarily auto-balanced.
*/

/* ===== Card inset (border-aware 16px) ===== */
#active-card-container .card-content-container {
  padding: calc(var(--space-m) - var(--card-border-width, 2px));
}

/* ===== Header block (two rows) ===== */
#active-card-container .card-header-container {
  display: flex;
  flex-direction: column;
  row-gap: 0; /* control spacing via margins on the lines below */
  margin: 0;
}

/* One header row: left label + right clock */
#active-card-container .card-header-line {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-m);
  min-width: 0;
  margin: 0;
}

/* Reset any stray default margins on nested headings/paragraphs */
#active-card-container .card-header-line h1,
#active-card-container .card-header-line h2,
#active-card-container .card-header-line h3,
#active-card-container .card-header-line h4,
#active-card-container .card-header-line h5,
#active-card-container .card-header-line h6,
#active-card-container .card-header-line p {
  margin: 0;
}

/* Header typography — readable (no clipping) */
#active-card-container .card-header-dynamic-text,
#active-card-container .card-header-clock {
  color: var(--on-surface-light);
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: var(--lh-normal);
  display: flex;
  align-items: baseline;
  gap: var(--space-m);
  min-width: 0;
}

/* Keep inner spans at normal line-height */
#active-card-container .card-header-dynamic-text > span,
#active-card-container .card-header-clock > span {
  line-height: var(--lh-normal);
}

/* Subtle right-edge alignment quirk preserved */
#active-card-container .card-header-line > *:last-child {
  margin-right: -1px;
}

/* ===== Selector under header =====
   CEMENTED: Lock outer shell to exactly 100px total height.
   TEMP: Vertical balance via flex centering; replace with tokenized padding later. */
#exercise-selector { margin: 0; }

#active-card-container .app-selector > summary {
  box-sizing: border-box;
  height: 100px;                 /* CEMENTED: requested exact height */
  min-height: 100px;             /* safety against external overrides */
  display: flex;                 /* TEMP auto-balance */
  align-items: center;           /* vertical centering for now */
  padding-top: 0;                /* prevent height creep */
  padding-bottom: 0;             /* prevent height creep */
  padding-left: var(--space-m);  /* keep 16px column */
  padding-right: var(--space-m); /* keep 16px column */
}

/* Selector typography (kept tasteful; will be tokenized later) */
#exercise-selector.app-selector { font-size: initial; font-weight: initial; }
#exercise-selector .selector-content { font-weight: 500; }
#exercise-selector .item-main-line {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 2px; /* TEMP for the 100px shell */
}
#exercise-selector .flex-separator { font-weight: 600; margin: 0 4px; }
#exercise-selector .options-list li .item-main-line { margin-bottom: 0; line-height: 1.1; }

/* ===== Other preserved layout ===== */
.youtube-overlay-wrapper { position: relative; }
.input-group { margin: 0; }
#card-anchor-area { position: relative; z-index: 1; }
#card-action-area { margin: 0; }

/* Action prompt + labels (unchanged) */
.action-prompt-text,
.resting-label {
  font-size: var(--font-size-h2);
  font-weight: 600;
  color: var(--primary-blue-dark);
  cursor: pointer;
  min-width: 0;
  text-align: center;
}
.resting-label { color: var(--on-surface-medium); }

.action-prompt-text > .truncate-text,
.resting-label > .truncate-text { line-height: var(--lh-normal); }

body.start-glow-animations .action-prompt-text.is-glowing span {
  animation: text-glow 4s ease-in-out infinite;
}

/* Buttons & dual areas */
.action-button-group { display: flex; flex-direction: column; gap: 16px; }
.timer-container { display: flex; flex-direction: column; }
.timer-container .timer-display {
  font-size: 5.5rem;
  font-weight: 700;
  line-height: var(--lh-normal);
  display: flex; align-items: center; justify-content: center;
}
.dual-fuel-gauge-container { display: flex; gap: 16px; height: var(--control-height); }
.dual-action-area-container { display: flex; gap: 16px; flex-grow: 1; }

/* Waiting state */
.waiting-card-message {
  color: var(--on-surface-medium);
  text-align: center;
  font-style: italic;
  padding: 40px 0;
}

/* Muting logic (preserved) */
.is-muted { pointer-events: none; }
.is-muted > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}
.is-muted > summary .selector-content { opacity: 0.2; }
summary.is-content-muted .selector-content { opacity: 0.2; }

/* Global override while ANY selector is open */
body.is-selector-open details:not([open]) { pointer-events: none; }
body.is-selector-open
  details:not(.workout-log-item-container):not([open])
  > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}
body.is-selector-open
  details:not(.workout-log-item-container):not([open])
  > summary .selector-content {
  filter: brightness(0.5) saturate(0.5);
  opacity: 0.7;
}

/* Utilities */
.text-primary { color: var(--primary-blue); }
.text-info    { color: var(--on-surface-medium); }

/* ---------------------------------------------------------------------------------
   CEMENTED — RHYTHM LOCK (specificity + order; adjust ONLY here if tokens change)
   Targets:
     • Top → “Current Exercise” line = 16px (visual)
     • “Current Exercise” → “# Minutes Remaining” = 7px (visual)
     • “# Minutes Remaining” → selector = 7px (visual)

   These micro-tweaks were measured to fix 17/9/15 → 16/7/7 exactly.
----------------------------------------------------------------------------------*/

/* Scoped micro-tokens — safe to tune if the font metrics change */
#active-card-container {
  --cap-tweak-top: 1px;        /* pulls first line up +1px → 16px top */
  --cap-tweak-internal: 2px;   /* reduces line↔line by 2px → 7px */
  --cap-tweak-bottom: 8px;     /* reduces second→selector by 8px → 7px */
}

/* Ensure we’re hitting the wrapper that renders header lines */
#active-card-container #active-card-header {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 0;
}

/* Top edge → first line = 16px */
#active-card-container #active-card-header > .card-header-line:first-child {
  margin-top: calc((var(--cap-offset-h2, 5px) + var(--cap-tweak-top)) * -1);
}

/* First line → second line = 7px (7 - 2*cap - tweak) */
#active-card-container #active-card-header > .card-header-line:nth-child(2) {
  margin-top: calc(var(--space-s) - (var(--cap-offset-h2, 5px) * 2) - var(--cap-tweak-internal));
}

/* Second line → selector = 7px (7 - cap - tweak) */
#active-card-container #active-card-header > .card-header-line:last-child {
  margin-bottom: calc(var(--space-s) - var(--cap-offset-h2, 5px) - var(--cap-tweak-bottom));
}

/* CEMENTED — Adherence color lock (resilient to re-renders) */
#active-card-container .card-header-line.text-plan .card-header-dynamic-text,
#active-card-container .card-header-line.text-plan .card-header-clock,
#active-card-container .card-header-line .card-header-dynamic-text.text-plan,
#active-card-container .card-header-line .card-header-clock.text-plan {
  color: var(--adherence-green);
}
#active-card-container .card-header-line.text-deviation .card-header-dynamic-text,
#active-card-container .card-header-line.text-deviation .card-header-clock,
#active-card-container .card-header-line .card-header-dynamic-text.text-deviation,
#active-card-container .card-header-line .card-header-clock.text-deviation {
  color: var(--adherence-olive);
}
#active-card-container .card-header-line.text-warning .card-header-dynamic-text,
#active-card-container .card-header-line.text-warning .card-header-clock,
#active-card-container .card-header-line .card-header-dynamic-text.text-warning,
#active-card-container .card-header-line .card-header-clock.text-warning {
  color: var(--adherence-yellow);
}
