/* ==========================================================================
   ACTIVE EXERCISE CARD - TOKENIZED SYSTEM
   
   CEMENT: Pixel-perfect spacing achieved through precise token adjustments
   - Universal card padding: 16px visual margins via global tokens
   - 100px selector height (exception to 50px standard - required for anti-shift)
   - Timer line-height: 0.7 (only sub-1 line-height allowed - treats as display object)
   
   ACHIEVED MEASUREMENTS:
   Inactive State:
   - Top to "Current Exercise": 16px ✓
   - Between header lines: 7px ✓ 
   - Header to selector: 7px ✓
   - "Begin Exercise" spacing: 19px ✓ (via 4px spacer)
   - "Begin Exercise" to "Log Set": 20px ✓
   
   Active State (Single):
   - Fuel gauge to "Resting For:": 16px ✓
   - "Resting For:" to timer: 16px ✓
   - Timer to "Skip Rest": 16px ✓
   
   Dual-Mode Active State:
   - "Resting For:" to timer: 16px ✓
   - "Resting For:" to "Log Set": 23px ✓ (via 1px transform)
   - Bottom button alignment preserved
   
   DO NOT modify without measuring ALL states for layout shift
   ========================================================================== */

/* =========================== LOCAL TOKENS =========================== */
/* These precise values achieve exact visual measurements across all states */

#active-card-container {
  /* Selector exception - 100px instead of standard 50px */
  --selector-height: 100px;       /* CEMENT: Must be 100px for anti-shift between states */
  --selector-padding-v: 20px;     /* Vertical padding within 100px */
  
  /* CEMENT: Header spacing tokens - DO NOT MODIFY */
  --header-line-spacing: 4px;     /* Exact 4px margin for 7px visual between lines */
  --header-line2-height: 0.7;     /* Line-height hack for Roboto second line */
  
  /* Fuel gauge spacing */
  --fuel-gauge-top: 9px;
  --fuel-gauge-bottom: 4px;
  
  /* State-specific spacing (defined per state) */
  --inactive-slack-top: 4px;      /* Creates 19px "Begin Exercise" spacing */
  --inactive-slack-bottom: 0px;   
  
  /* Timer adjustments for active state */
  --active-timer-line-height: 0.7; /* CEMENT: Required for large text alignment - do not change */
  --active-timer-top: 5px;
  --active-timer-bottom: 9px;
  
  /* Dual-mode specific adjustments */
  --dual-resting-to-logset: 7px;    /* Creates 23px visual from "Resting For:" to Log Set button */
}

/* =========================== CARD FOUNDATION =========================== */

/* CEMENT: Card padding achieves exact 16px visual margins 
   DO NOT MODIFY - 11px top padding is precisely calibrated with 
   Roboto font metrics to achieve 16px from border to text baseline */
#active-card-container .card-content-container {
  padding: 11px 14px 14px 14px; /* CEMENT: 11px top = 16px visual to header */
  box-sizing: border-box;
}

/* Stack layout system */
#active-card-container .stack {
  display: flex;
  flex-direction: column;
  gap: var(--space-m); /* Default 16px rhythm */
}

/* Override inline stack spacing for header/selector area */
#active-card-container .header-and-selector-group.stack {
  gap: 0 !important; /* Manual control for precise 7px spacing */
}

#active-card-container .stack[style*="--stack-space"] {
  gap: var(--stack-space);
}

/* =========================== HEADER SECTION =========================== */
/* CEMENT: Header spacing achieves EXACT 16/7/7 rhythm 
   DO NOT MODIFY - These values were battle-tested and are the ONLY 
   combination that works with Roboto font metrics at 1.25rem
   
   ACHIEVED:
   - 16px: Card top border to "Current Exercise" baseline
   - 7px: "Current Exercise" baseline to "Minutes Remaining" baseline  
   - 7px: "Minutes Remaining" baseline to selector top border
*/

#active-card-container .card-header-container,
#active-card-container #active-card-header {
  display: flex;
  flex-direction: column;
  gap: 0; /* CEMENT: Must be 0 - spacing controlled via margins */
  margin: 0;
  padding: 0;
}

/* CEMENT: Header to selector spacing - DO NOT CHANGE */
#active-card-container #active-card-header {
  margin-bottom: 7px !important; /* Exact 7px to selector border */
}

#active-card-container .card-header-line {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-m);
  margin: 0;
  padding: 0;
  min-width: 0;
}

/* CEMENT: Second line spacing - THE ONLY WORKING SOLUTION */
#active-card-container .card-header-line:nth-child(2) {
  margin-top: var(--header-line-spacing); /* Tokenized 4px for maintainability */
}

/* Header typography - standard for first line */
#active-card-container .card-header,
#active-card-container .card-header-clock {
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: 1;
  color: var(--on-surface-light);
  margin: 0;
  padding: 0;
}

/* Header typography - all dynamic text elements */
#active-card-container .card-header-dynamic-text {
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: 1;
  color: var(--on-surface-light);
  margin: 0;
  padding: 0;
}

/* CEMENT: Second line display element treatment
   The "Minutes Remaining" text and estimated completion clock are treated
   as display elements requiring special line-height compression.
   This 0.7 line-height is the ONLY value that achieves proper 7px spacing
   with Roboto at 1.25rem. DO NOT MODIFY. */
#active-card-container .card-header-line:nth-child(2) .card-header-dynamic-text {
  line-height: var(--header-line2-height) !important; /* Tokenized 0.7 hack */
  display: inline-block; /* Ensures line-height is respected */
}

/* Color preservation for dynamic header updates */
#active-card-container .card-header-line.text-plan .card-header-dynamic-text,
#active-card-container .card-header-line.text-plan .card-header-clock,
#active-card-container .text-plan .card-header-dynamic-text,
#active-card-container .text-plan .card-header-clock {
  color: var(--text-green-plan) !important;
}

#active-card-container .card-header-line.text-deviation .card-header-dynamic-text,
#active-card-container .card-header-line.text-deviation .card-header-clock,
#active-card-container .text-deviation .card-header-dynamic-text,
#active-card-container .text-deviation .card-header-clock {
  color: var(--text-olive-deviation) !important;
}

#active-card-container .card-header-line.text-warning .card-header-dynamic-text,
#active-card-container .card-header-line.text-warning .card-header-clock,
#active-card-container .text-warning .card-header-dynamic-text,
#active-card-container .text-warning .card-header-clock {
  color: var(--text-yellow-maintenance) !important;
}

/* Ensure spans inside headers don't break alignment */
#active-card-container .card-header span,
#active-card-container .card-header-clock span,
#active-card-container .card-header-dynamic-text span {
  line-height: inherit;
  vertical-align: baseline;
  display: inline;
}

/* =========================== EXERCISE SELECTOR =========================== */
/* CEMENT: 100px height critical for preventing layout shift between states */

#exercise-selector {
  margin: 0 !important;
}

/* Override any wrapper spacing */
.youtube-overlay-wrapper {
  position: relative;
  margin: 0 !important;
  padding: 0 !important;
}

#exercise-selector.app-selector > summary {
  height: var(--selector-height);     /* Uses local 100px exception token */
  min-height: var(--selector-height);
  padding: var(--selector-padding-v) var(--selector-padding-h);
  
  /* Flex centering for content */
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
}

/* Selector content */
#exercise-selector .selector-content {
  font-weight: 500;
  width: 100%;
}

#exercise-selector .item-main-line {
  font-size: var(--font-size-h2);
  font-weight: 600;
  margin-bottom: 2px;
}

#exercise-selector .item-sub-line {
  font-size: var(--font-size-body-m);
  line-height: 1.1;
}

#exercise-selector .flex-separator {
  margin: 0 var(--space-xxs);
  font-weight: 600;
}

/* YouTube overlay button */
.youtube-overlay-wrapper {
  position: relative;
}

.youtube-overlay-button {
  position: absolute;
  bottom: 6px;  /* Adjusted to achieve 4px visual */
  right: 6px;   /* Adjusted to achieve 4px visual */
  /* Button styles inherited from buttons.css */
}

/* =========================== INPUT SECTION =========================== */

.input-group {
  margin: 0;
  padding: 0;
}

.input-2col-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  row-gap: var(--space-s);
  column-gap: var(--space-m);
}

.input-label {
  font-weight: 500;
  color: var(--on-surface-medium);
}

/* Number input inherits from _inputs.css */

/* =========================== FUEL GAUGE ANCHOR =========================== */

#card-anchor-area {
  position: relative;
  z-index: 1;
  margin-top: var(--fuel-gauge-top) !important;
  margin-bottom: 3px !important; /* Reduced from 4px to achieve 20px total */
  padding: 0 !important;
}

.fuel-gauge-container {
  display: flex;
  gap: var(--fuel-gauge-gap);
  height: var(--control-height);
}

.dual-fuel-gauge-container {
  display: flex;
  gap: var(--space-m);
  height: var(--control-height);
}

/* =========================== ACTION AREA =========================== */

#card-action-area {
  margin: 0 !important;
  padding: 0 !important;
}

/* Action prompt block */
.action-prompt-block {
  margin: 0 !important;
  padding: 0 !important;
}

#active-card-container .action-prompt-block.is-prompt {
  margin: 0 !important;
  padding: 0 !important;
}

/* Target the actual prompt text element */
#active-card-container .action-prompt-text {
  margin: 0 !important;
  padding: 0 !important;
}

/* CEMENT: Spacer divs create exact anti-shift spacing for inactive state
   Direct values used after discovering non-linear token behavior
   4px top spacer = 19px visual "Begin Exercise" spacing
   0px bottom spacer + button adjustment = 20px to "Log Set" */
.action-prompt-spacer-top {
  display: block !important;
  height: 4px !important;  /* Creates exact 19px visual spacing */
  margin: 0 !important;
  padding: 0 !important;
  line-height: 0 !important;
  font-size: 0 !important;
  border: none !important;
  min-height: 4px !important;
  max-height: 4px !important;
}

.action-prompt-spacer-bottom {
  display: block !important;
  height: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  line-height: 0 !important;
  font-size: 0 !important;
  border: none !important;
}

/* Override stack spacing for action area */
#active-card-container #card-action-area.stack {
  gap: var(--space-m) !important; /* Force 16px */
}

/* Action buttons - target from top to reduce gap */
#active-card-container .action-button-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-m);
  margin: -1px 0 0 0 !important; /* Negative top margin to pull up by 1px */
  padding: 0 !important;
}

.action-prompt-text,
.resting-label {
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: var(--lh-normal);
  text-align: center;
  margin: 0;
  padding: 0;
  cursor: pointer;
}

.action-prompt-text {
  color: var(--primary-blue-dark);
}

.resting-label {
  color: var(--on-surface-medium);
}

/* Action buttons */
.action-button-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-m);
  margin: 0;
  padding: 0;
}

/* Timer container */
.timer-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 0;
  padding: 0;
}

.timer-display {
  font-size: 5.5rem;
  font-weight: 700;
  line-height: var(--lh-normal);
  color: var(--on-surface-light);
  text-align: center;
  display: block;
  margin: 0;
  padding: 0;
}

/* =========================== STATE: INACTIVE (PROMPT) =========================== */

/* Inactive uses spacers to prevent shift when switching to active */
#active-card-container .action-prompt-block.is-prompt .action-prompt-spacer-top {
  height: var(--inactive-slack-top);
}

#active-card-container .action-prompt-block.is-prompt .action-prompt-spacer-bottom {
  height: var(--inactive-slack-bottom);
}

/* =========================== STATE: ACTIVE (RESTING) =========================== */
/* CEMENT: Single timer state achieves perfect 16/16/16 spacing:
   - 1px margin-top on resting block (16px from fuel gauge)
   - 12px stack gap compensates for timer line-height
   - Timer line-height 0.7 is essential - do not change
   - 4px margin-bottom on timer maintains 16px to button */

/* Remove all spacing from resting block - let stack control */
#active-card-container .action-prompt-block.is-resting,
#active-card-container .action-prompt-block.is-resting * {
  margin: 0 !important;
  padding: 0 !important;
}

/* Hide spacers in active state */
#active-card-container .action-prompt-block.is-resting .action-prompt-spacer-top,
#active-card-container .action-prompt-block.is-resting .action-prompt-spacer-bottom {
  display: none !important;
}

/* Adjust "Resting For:" text position */
#active-card-container .action-prompt-block.is-resting {
  margin-top: 1px !important;  /* Creates 16px from fuel gauge */
}

/* Stack gaps differ by state to maintain visual rhythm */
#active-card-container #card-action-area.stack:has(.action-prompt-block.is-prompt) {
  gap: 16px !important;  /* Inactive state maintains standard gap */
}

#active-card-container #card-action-area.stack:has(.action-prompt-block.is-resting) {
  gap: 12px !important;  /* Compensates for timer line-height to achieve visual 16px */
}

/* Timer container - no extra margins */
#active-card-container .timer-container {
  margin: 0 !important;
  padding: 0 !important;
}

/* CEMENT: Timer compensation for perfect spacing to button */
#active-card-container .action-prompt-block.is-resting ~ .timer-container {
  margin-bottom: 4px !important; /* Maintains 16px to Skip Rest button */
}

/* Timer display - CEMENT: line-height 0.7 required for large display text
   Only acceptable sub-1 line-height in app - treats timer as graphic element */
.timer-display {
  font-size: 5.5rem;
  font-weight: 700;
  line-height: var(--timer-line-height) !important;  /* DO NOT CHANGE - required for pixel-perfect alignment */
  color: var(--on-surface-light);
  text-align: center;
  display: block;
  margin: 0 !important;
  padding: 0 !important;
}

/* Action buttons in active state */
#active-card-container .action-prompt-block.is-resting ~ .action-button-group {
  margin: 0 !important;
  padding: 0 !important;
}

/* =========================== STATE: DUAL MODE (SUPERSET/PARTNER) =========================== */

.dual-action-area-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-m);
  align-items: start; /* Critical for independent columns */
}

.action-area-cell {
  margin: 0;
  padding: 0;
}

/* Timer and skip container for dual mode */
.timer-and-skip-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-m);
  margin: 0;
  padding: 0;
}

/* Dual mode timer adjustments */
.dual-action-area-container .timer-display {
  line-height: var(--timer-line-height);
}

/* Dual-mode active state - maintain standard 16px to timer
   The dual-action-area-container uses standard spacing by default */
#active-card-container .action-prompt-block.is-resting + .dual-action-area-container {
  margin-top: 0 !important; /* Standard 16px from stack gap to maintain timer spacing */
}

/* CEMENT: Transform creates exact 23px from "Resting For:" to "Log Set"
   1px visual shift aligns bottom buttons without affecting timer spacing */
.dual-action-area-container:has(.timer-and-skip-container) .action-area-cell:not(:has(.timer-and-skip-container)) .action-button-group {
  transform: translateY(1px) !important;
}

/* =========================== COLORS & STATES =========================== */

/* Session color classes */
.text-plan { color: var(--text-green-plan); }
.text-deviation { color: var(--text-olive-deviation); }
.text-warning { color: var(--text-yellow-maintenance); }
.text-orange { color: var(--text-orange-deviation); }
.text-skip { color: var(--text-red-skip); }
.text-primary { color: var(--primary-blue); }

/* Muted state */
.is-muted {
  pointer-events: none;
}

.is-muted > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}

.is-muted > summary .selector-content {
  opacity: 0.2;
}

/* Selector open states */
body.is-selector-open details:not([open]) {
  pointer-events: none;
}

body.is-selector-open details:not([open]) > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}

body.is-selector-open details:not([open]) > summary .selector-content {
  filter: brightness(0.5) saturate(0.5);
  opacity: 0.7;
}

/* =========================== ANIMATIONS =========================== */

/* Glow animation for prompt text */
body.start-glow-animations .action-prompt-text.is-glowing span {
  animation: text-glow 4s ease-in-out infinite;
}

/* Border glow for card */
.is-glowing-border {
  animation: border-glow 4s ease-in-out infinite;
}

/* =========================== SPECIAL STATES =========================== */

/* Waiting/completion message */
.waiting-card-message {
  color: var(--on-surface-medium);
  text-align: center;
  font-style: italic;
  padding: var(--space-xl) 0;
  margin: 0;
}

/* Rest day */
.rest-day-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
}

.rest-day-text {
  font-size: var(--font-size-h2);
  font-weight: 600;
  color: var(--on-surface-medium);
}