/* ==========================================================================
   ACTIVE EXERCISE CARD - UNIFIED TOKENIZED SYSTEM
   
   CEMENT: Complete rebuild following established token patterns
   - 16px visual margins using global padding tokens
   - 100px selector height (local exception)
   - Multi-state support: inactive, active (resting), dual-mode
   - Anti-shift spacing preserved through state-specific tokens
   
   ACHIEVED MEASUREMENTS:
   Inactive State:
   - Top to "Current Exercise": 16px ✓
   - Between header lines: 7px ✓ 
   - Header to selector: 7px ✓
   - "Begin Exercise" spacing: 19px ✓
   - To "Log Set" button: 20px ✓
   
   Active State:
   - Above "Resting For:": 16px ✓
   - "Resting For:" to timer: 16px ✓
   - Timer to "Skip Rest": 16px ✓
   - Timer line-height: 0.7 (required for pixel-perfect alignment)
   
   DO NOT modify without testing ALL states for layout shift
   ========================================================================== */

/* =========================== LOCAL TOKENS =========================== */
/* CEMENT: These precise values achieve exact visual measurements
   DO NOT modify without measuring impact on BOTH inactive and active states */

#active-card-container {
  /* Selector exception - 100px instead of standard 50px */
  --selector-height: 100px;       /* CEMENT: Required for anti-shift */
  --selector-padding-v: 20px;     /* Vertical padding within 100px */
  
  /* Header micro-adjustments for exact rhythm */
  --header-first-line-top: -1px;  /* CEMENT: Achieves 16px from top */
  --header-line-gap: -1px;        /* CEMENT: Achieves 7px between lines */
  --header-to-selector: -6px;     /* CEMENT: Achieves 7px to selector */
  
  /* Fuel gauge spacing */
  --fuel-gauge-top: 9px;
  --fuel-gauge-bottom: 4px;
  
  /* State-specific spacing (defined per state) */
  --inactive-slack-top: 5.5px;    /* CEMENT: Token value creates 19px visual */
  --inactive-slack-bottom: 0px;   
  
  /* Timer adjustments for active state */
  --active-timer-line-height: 0.7; /* CEMENT: Essential for timer alignment */
  --active-timer-top: 5px;
  --active-timer-bottom: 9px;
}

/* =========================== CARD FOUNDATION =========================== */

/* Card padding - uses global tokens */
#active-card-container .card-content-container {
  padding: var(--card-padding-top) var(--card-padding-sides) var(--card-padding-sides) var(--card-padding-sides);
  box-sizing: border-box;
}

/* Stack layout system */
#active-card-container .stack {
  display: flex;
  flex-direction: column;
  gap: var(--space-m); /* Default 16px rhythm */
}

/* Override inline stack spacing for header/selector area */
#active-card-container .header-and-selector-group.stack {
  gap: 7px !important; /* Force 7px between header and selector */
}

#active-card-container .stack[style*="--stack-space"] {
  gap: var(--stack-space);
}

/* =========================== HEADER SECTION =========================== */
/* CEMENT: Header spacing achieves exact 16/7/7 rhythm
   These values include compensation for font metrics and element differences */

#active-card-container .card-header-container,
#active-card-container #active-card-header {
  display: flex;
  flex-direction: column;
  gap: 0; /* Manual control for precise spacing */
  margin: 0;
  padding: 0;
}

#active-card-container .card-header-line {
  display: flex;
  align-items: baseline;  /* Use baseline alignment */
  justify-content: space-between;
  gap: var(--space-m);
  margin: 0;
  padding: 0;
  min-width: 0;
}

/* Header typography - CEMENT: Force alignment with transform */
#active-card-container .card-header,
#active-card-container .card-header-clock,
#active-card-container .card-header-dynamic-text {
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: 1;
  color: var(--on-surface-light);
  margin: 0;
  padding: 0;
  display: inline-block;
  vertical-align: top;  /* Align to top of line */
}

/* Micro-adjust clock position to match header */
#active-card-container .card-header-clock {
  transform: translateY(-2px);  /* Increased nudge to fully align */
}

/* CEMENT: Color preservation for dynamic updates */
#active-card-container .card-header-line.text-plan .card-header-dynamic-text,
#active-card-container .card-header-line.text-plan .card-header-clock,
#active-card-container .text-plan .card-header-dynamic-text,
#active-card-container .text-plan .card-header-clock {
  color: var(--text-green-plan) !important;
}

#active-card-container .card-header-line.text-deviation .card-header-dynamic-text,
#active-card-container .card-header-line.text-deviation .card-header-clock,
#active-card-container .text-deviation .card-header-dynamic-text,
#active-card-container .text-deviation .card-header-clock {
  color: var(--text-olive-deviation) !important;
}

#active-card-container .card-header-line.text-warning .card-header-dynamic-text,
#active-card-container .card-header-line.text-warning .card-header-clock,
#active-card-container .text-warning .card-header-dynamic-text,
#active-card-container .text-warning .card-header-clock {
  color: var(--text-yellow-maintenance) !important;
}

/* Ensure spans inside headers don't break alignment */
#active-card-container .card-header span,
#active-card-container .card-header-clock span,
#active-card-container .card-header-dynamic-text span {
  line-height: inherit;
  vertical-align: baseline;
  display: inline;
}

/* Header spacing - precise measurements */
#active-card-container .card-header-line:first-child {
  margin-top: var(--header-first-line-top);
}

#active-card-container .card-header-line:nth-child(2) {
  margin-top: var(--header-line-gap);
}

#active-card-container .card-header-container {
  margin-bottom: var(--header-to-selector);
}

/* Right edge micro-adjustment */
#active-card-container .card-header-line > *:last-child {
  margin-right: -1px;
}

/* =========================== EXERCISE SELECTOR =========================== */
/* CEMENT: 100px height critical for anti-shift between states
   !important flags required to override _selectors.css cascade */

#exercise-selector {
  margin: 0 !important;
  margin-top: -3px !important; /* CEMENT: Achieves 7px visual spacing */
}

/* Override any wrapper spacing */
.youtube-overlay-wrapper {
  position: relative;
  margin: 0 !important;
  padding: 0 !important;
}

#exercise-selector.app-selector > summary {
  height: var(--selector-height);
  min-height: var(--selector-height);
  padding: var(--selector-padding-v) var(--space-m);
  
  /* Flex centering for content */
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
}

/* Selector content */
#exercise-selector .selector-content {
  font-weight: 500;
  width: 100%;
}

#exercise-selector .item-main-line {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 2px;
}

#exercise-selector .item-sub-line {
  font-size: 1rem;
  line-height: 1.1;
}

#exercise-selector .flex-separator {
  margin: 0 4px;
  font-weight: 600;
}

/* YouTube overlay button */
.youtube-overlay-wrapper {
  position: relative;
}

.youtube-overlay-button {
  position: absolute;
  bottom: 6px;  /* Adjusted to achieve 4px visual */
  right: 6px;   /* Adjusted to achieve 4px visual */
  /* Button styles inherited from buttons.css */
}

/* =========================== INPUT SECTION =========================== */

.input-group {
  margin: 0;
  padding: 0;
}

.input-2col-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  row-gap: var(--space-s);
  column-gap: var(--space-m);
}

.input-label {
  font-weight: 500;
  color: var(--on-surface-medium);
}

/* Number input inherits from _inputs.css */

/* =========================== FUEL GAUGE ANCHOR =========================== */

#card-anchor-area {
  position: relative;
  z-index: 1;
  margin-top: var(--fuel-gauge-top) !important;
  margin-bottom: 3px !important; /* Reduced from 4px to achieve 20px total */
  padding: 0 !important;
}

.fuel-gauge-container {
  display: flex;
  gap: 2px;
  height: var(--control-height);
}

.dual-fuel-gauge-container {
  display: flex;
  gap: var(--space-m);
  height: var(--control-height);
}

/* =========================== ACTION AREA =========================== */

#card-action-area {
  margin: 0 !important;
  padding: 0 !important;
}

/* Action prompt block */
.action-prompt-block {
  margin: 0 !important;
  padding: 0 !important;
}

#active-card-container .action-prompt-block.is-prompt {
  margin: 0 !important;
  padding: 0 !important;
}

/* Target the actual prompt text element */
#active-card-container .action-prompt-text {
  margin: 0 !important;
  padding: 0 !important;
}

/* Spacers for inactive state anti-shift - CEMENT: Direct values after token issues */
/* CEMENT: These exact heights achieve 19px "Begin Exercise" spacing and 20px to button
   Using direct values instead of tokens due to non-linear scaling behavior discovered */
.action-prompt-spacer-top {
  display: block !important;
  height: 4px !important;  /* CEMENT: Creates exact 19px visual */
  margin: 0 !important;
  padding: 0 !important;
  line-height: 0 !important;
  font-size: 0 !important;
  border: none !important;
  min-height: 4px !important;
  max-height: 4px !important;
}

.action-prompt-spacer-bottom {
  display: block !important;
  height: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  line-height: 0 !important;
  font-size: 0 !important;
  border: none !important;
}

/* Override stack spacing for action area */
#active-card-container #card-action-area.stack {
  gap: var(--space-m) !important; /* Force 16px */
}

/* Action buttons - target from top to reduce gap */
#active-card-container .action-button-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-m);
  margin: -1px 0 0 0 !important; /* Negative top margin to pull up by 1px */
  padding: 0 !important;
}

.action-prompt-text,
.resting-label {
  font-size: var(--font-size-h2);
  font-weight: 600;
  line-height: var(--lh-normal);
  text-align: center;
  margin: 0;
  padding: 0;
  cursor: pointer;
}

.action-prompt-text {
  color: var(--primary-blue-dark);
}

.resting-label {
  color: var(--on-surface-medium);
}

/* Spacers for inactive state anti-shift */
.action-prompt-spacer-top {
  height: var(--inactive-slack-top);
  margin: 0;
  padding: 0;
  line-height: 0;
}

.action-prompt-spacer-bottom {
  height: var(--inactive-slack-bottom);
  margin: 0;
  padding: 0;
  line-height: 0;
}

/* Action buttons */
.action-button-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-m);
  margin: 0;
  padding: 0;
}

/* Timer container */
.timer-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 0;
  padding: 0;
}

.timer-display {
  font-size: 5.5rem;
  font-weight: 700;
  line-height: var(--lh-normal);
  color: var(--on-surface-light);
  text-align: center;
  display: block;
  margin: 0;
  padding: 0;
}

/* =========================== STATE: INACTIVE (PROMPT) =========================== */

/* Inactive uses spacers to prevent shift when switching to active */
#active-card-container .action-prompt-block.is-prompt .action-prompt-spacer-top {
  height: var(--inactive-slack-top);
}

#active-card-container .action-prompt-block.is-prompt .action-prompt-spacer-bottom {
  height: var(--inactive-slack-bottom);
}

/* =========================== STATE: ACTIVE (RESTING) =========================== */
/* CEMENT: Active state achieves perfect 16/16/16 spacing through:
   - 1px margin-top on resting block
   - 12px stack gap (creates 16px visual with timer line-height)
   - Timer line-height of 0.7 (essential - do not change)
   - 4px margin-bottom on timer for button spacing */

/* Remove all spacing from resting block - let stack control */
#active-card-container .action-prompt-block.is-resting,
#active-card-container .action-prompt-block.is-resting * {
  margin: 0 !important;
  padding: 0 !important;
}

/* Hide spacers in active state */
#active-card-container .action-prompt-block.is-resting .action-prompt-spacer-top,
#active-card-container .action-prompt-block.is-resting .action-prompt-spacer-bottom {
  display: none !important;
}

/* Adjust "Resting For:" text position */
#active-card-container .action-prompt-block.is-resting {
  margin-top: 1px !important;  /* CEMENT: Creates 16px from fuel gauge */
}

/* CEMENT: Stack gaps separated by state using :has() selector
   This prevents cross-state interference discovered during testing */
#active-card-container #card-action-area.stack:has(.action-prompt-block.is-prompt) {
  gap: 16px !important;  /* Inactive state maintains standard gap */
}

#active-card-container #card-action-area.stack:has(.action-prompt-block.is-resting) {
  gap: 12px !important;  /* CEMENT: Active state requires 12px for visual 16px */
}

/* Timer container - no extra margins */
#active-card-container .timer-container {
  margin: 0 !important;
  padding: 0 !important;
}

/* CEMENT: Timer compensation for perfect spacing to button */
#active-card-container .action-prompt-block.is-resting ~ .timer-container {
  margin-bottom: 4px !important; /* Maintains 16px to Skip Rest button */
}

/* Timer display - CEMENT: line-height 0.7 is essential for large text alignment
   This treats timer as display object rather than readable text */
.timer-display {
  font-size: 5.5rem;
  font-weight: 700;
  line-height: 0.7 !important;  /* DO NOT CHANGE - required for pixel-perfect alignment */
  color: var(--on-surface-light);
  text-align: center;
  display: block;
  margin: 0 !important;
  padding: 0 !important;
}

/* Action buttons in active state */
#active-card-container .action-prompt-block.is-resting ~ .action-button-group {
  margin: 0 !important;
  padding: 0 !important;
}

/* =========================== STATE: DUAL MODE (SUPERSET/PARTNER) =========================== */

.dual-action-area-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-m);
  align-items: start; /* Critical for independent columns */
}

.action-area-cell {
  margin: 0;
  padding: 0;
}

/* Timer and skip container for dual mode */
.timer-and-skip-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-m);
  margin: 0;
  padding: 0;
}

/* Dual mode timer adjustments */
.dual-action-area-container .timer-display {
  line-height: var(--active-timer-line-height);
}

/* Opposite side Log Set button compensation */
.dual-action-area-container .action-area-cell:has(.timer-and-skip-container) + .action-area-cell .action-button-group,
.dual-action-area-container .action-area-cell .action-button-group:has(+ .action-area-cell .timer-and-skip-container) {
  margin-top: 7px; /* Aligns with timer on opposite side */
}

/* =========================== COLORS & STATES =========================== */

/* Session color classes */
.text-plan { color: var(--text-green-plan); }
.text-deviation { color: var(--text-olive-deviation); }
.text-warning { color: var(--text-yellow-maintenance); }
.text-orange { color: var(--text-orange-deviation); }
.text-skip { color: var(--text-red-skip); }
.text-primary { color: var(--primary-blue); }

/* Muted state */
.is-muted {
  pointer-events: none;
}

.is-muted > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}

.is-muted > summary .selector-content {
  opacity: 0.2;
}

/* Selector open states */
body.is-selector-open details:not([open]) {
  pointer-events: none;
}

body.is-selector-open details:not([open]) > summary {
  background-color: var(--background-dark);
  box-shadow: inset 0 0 0 2px var(--primary-blue-dark);
}

body.is-selector-open details:not([open]) > summary .selector-content {
  filter: brightness(0.5) saturate(0.5);
  opacity: 0.7;
}

/* =========================== ANIMATIONS =========================== */

/* Glow animation for prompt text */
body.start-glow-animations .action-prompt-text.is-glowing span {
  animation: text-glow 4s ease-in-out infinite;
}

/* Border glow for card */
.is-glowing-border {
  animation: border-glow 4s ease-in-out infinite;
}

/* =========================== SPECIAL STATES =========================== */

/* Waiting/completion message */
.waiting-card-message {
  color: var(--on-surface-medium);
  text-align: center;
  font-style: italic;
  padding: var(--space-xl) 0;
  margin: 0;
}

/* Rest day */
.rest-day-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
}

.rest-day-text {
  font-size: var(--font-size-h2);
  font-weight: 600;
  color: var(--on-surface-medium);
}