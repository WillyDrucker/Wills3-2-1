Project_Notes_v5.1.8.txt
==================================================

SCOPE (Single Source of Truth for this session)
- Focus: ACTIVE card — NORMAL WORKOUT only.
- INACTIVE card spacing is locked at 16/16 and must not change.
- Superset/Partner modes must not be affected by active-card changes.

--------------------------------------------------
CEMENTED — NON‑NEGOTIABLES
- App renders strictly from appState (Event → Update → Re-render).
- Global rhythm: 16px inset; 7px header→selector; 16px between major groups.
- Current Exercise selector height = 100px.
- Adherence color logic must not regress.
- Layout is TOKENIZED. No hacks: no `!important`, no negative line-height, no structure changes.
- Inactive spacing around the “Begin Exercise – Log Results” text group stays at 16/16 (see tokens below).

--------------------------------------------------
STATUS @ START OF v5.1.8
- INACTIVE (no timer): ✅ locked at 16/16.
  Tokens (DO NOT CHANGE):
    --anchor-gap-top: 9px
    --anchor-gap-bottom: 4px
    --cap-fix-action-prompt-top: 0px
    --cap-fix-action-prompt-bottom: 4px
    --action-prompt-spacer-top: 0px
    --action-prompt-spacer-bottom: 0px

- ACTIVE (normal workout, timer running): ❌ needs tuning.
  Latest measurements (target → 16/16/16):
    • Fuel Gauge → “Resting For:” = 16px  (OK, keep)
    • “Resting For:” → Timer = 31px       (needs 16px)
    • Timer → “Skip Rest” = 27px          (needs 16px)

--------------------------------------------------
ACTIVE CARD — INTENT & MECHANICS (Normal Workout Only)
- The active action area uses the `.stack` utility (in `_helpers.css`) to separate direct children with the stack gap (defaults to 16px).
- Normal workout DOM (simplified):
    #card-action-area.stack
      > .action-prompt-block.is-resting
          .action-prompt-spacer-top
          p.resting-label
          .action-prompt-spacer-bottom
      > .timer-container
          p.timer-display
      > .action-button-group
- Our goal: make the **stack gap** the *only* contributor between these three blocks so the rhythm lands at 16/16/16.
- Root causes of inflation:
    • Spacer wrappers (`.action-prompt-spacer-top/bottom`) add extra height.
    • Residual margins/padding on `.resting-label`, `.timer-container`, and/or `.action-button-group`.

--------------------------------------------------
TOKENS — MUST EXIST (values may be tuned ±1–3px IF NEEDED for ACTIVE ONLY)
(Do not remove any tokens. Inactive tokens remain exactly as above.)
Active / label & spacing:
  --cap-fix-resting-label-top: 0px
  --cap-fix-resting-label-bottom: 16px   (may be tuned to land exact 16px label→timer)
Active / wrapper spacers:
  --cap-fix-resting-wrapper-top: 0px
  --cap-fix-resting-wrapper-bottom: 0px  (keep 0 to prevent additive spacing)
Timer:
  --cap-fix-timer-top: 0px
  --cap-fix-timer-bottom: 0px
Global (already in system):
  --space-m: 16px
  --lh-normal: [project default, do not hack]

Optional active‑only tuners (define only if needed; prefer relying on stack gap first):
  --active-resting-to-timer-gap: 16px
  --active-timer-to-buttons-gap: 16px
(Use only to compensate for platform rendering quirks if the pure stack approach cannot land 16/16/16.)

--------------------------------------------------
SELECTORS / RULES TO ENFORCE (Active, Normal Workout Only)
High‑specificity, active‑only, NO impact on inactive/superset/partner.
These live in: `src/features/active-exercise-card/active-exercise-card.style.css`

/* Active — normal workout: rely on 16px stack gap, remove additive spacing */
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting {
  margin: 0; padding: 0;
}
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting .action-prompt-spacer-top,
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting .action-prompt-spacer-bottom {
  height: var(--cap-fix-resting-wrapper-top, 0px);   /* top */
  margin: 0; padding: 0; line-height: 0;
}
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting .action-prompt-spacer-bottom {
  height: var(--cap-fix-resting-wrapper-bottom, 0px); /* bottom */
}
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting .resting-label {
  margin-top: var(--cap-fix-resting-label-top);
  margin-bottom: var(--cap-fix-resting-label-bottom);
  line-height: var(--lh-normal);
}
#active-card-container #card-action-area.stack > .timer-container {
  margin: 0; padding: 0;
}
#active-card-container #card-action-area.stack > .timer-container .timer-display {
  margin: 0; line-height: var(--lh-normal);
}
#active-card-container #card-action-area.stack > .action-button-group {
  margin: 0; padding-top: 0; padding-bottom: 0;
}

/* Guard: ensure only the stack gap contributes between the three siblings */
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting + .timer-container { margin-top: 0; }
#active-card-container #card-action-area.stack > .timer-container + .action-button-group { margin-top: 0; }

Notes:
- If the runtime DOM introduces an extra wrapper between `.is-resting` and `.timer-container`, add a single, narrowly scoped rule to zero that wrapper’s margins/padding (active‑only). Do not alter structure.

--------------------------------------------------
INACTIVE CARD — REFERENCE (Do Not Change)
File: `src/styles/base/_variables.css`
  --anchor-gap-top: 9px
  --anchor-gap-bottom: 4px
  --cap-fix-action-prompt-top: 0px
  --cap-fix-action-prompt-bottom: 4px
  --action-prompt-spacer-top: 0px
  --action-prompt-spacer-bottom: 0px

File: `src/features/active-exercise-card/active-exercise-card.style.css`
  #active-card-container #card-anchor-area {
    margin-top: var(--anchor-gap-top);
    margin-bottom: var(--anchor-gap-bottom);
  }
  #active-card-container #card-action-area .action-prompt-block.is-prompt .action-prompt-text {
    margin-top: var(--cap-fix-action-prompt-top);
    margin-bottom: var(--cap-fix-action-prompt-bottom);
  }
  #active-card-container #card-action-area .action-button-group { margin: 0; padding-top: 0; padding-bottom: 0; }

--------------------------------------------------
DIAGNOSTICS (Optional; remove before final)
/* DEBUG */
#active-card-container #card-action-area.stack > * { outline: 1px dashed rgba(0,0,0,.25); }
#active-card-container #card-action-area.stack > .action-prompt-block.is-resting * { background: rgba(255,0,0,.03); }

--------------------------------------------------
DONE WHEN
- ACTIVE (normal workout) measures exactly 16/16/16:
  Fuel Gauge → “Resting For:” = 16
  “Resting For:” → Timer = 16
  Timer → “Skip Rest” = 16
- INACTIVE remains 16/16.
- No changes to adherence color logic, selector height (100px), or global rhythm (16/7/16).
- No use of `!important`, negative line-height, or structure changes.

--------------------------------------------------
DELIVERABLES
Provide updated full files (unzipped) for ANY and ALL files you modify or add — no limit.
Include everything changed to meet the goals while honoring the non‑negotiables.
Typical files may include (but are not limited to):
- src/styles/base/_variables.css
- src/features/active-exercise-card/active-exercise-card.style.css
- src/features/active-exercise-card/active-exercise-card.templates.actionArea.js
- src/features/active-exercise-card/active-exercise-card.templates.workoutCard.js
- src/styles/utils/_helpers.css
- src/styles/components/_buttons.css
- (and any other touched file such as _fuel-gauge.css, etc.)

--------------------------------------------------
CHANGELOG (v5.1.8)
- Locked INACTIVE spacing at 16/16 via tokens; added comments-only cement to map tokens → margins.
- Scoped ACTIVE (normal) fixes under #card-action-area.stack + .action-prompt-block.is-resting.
- Neutralized spacer wrappers and residual margins to rely on 16px stack gap between primary siblings.
- Kept line-height at var(--lh-normal); no hacks, no structure changes.
